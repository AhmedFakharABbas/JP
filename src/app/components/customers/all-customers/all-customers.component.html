<section class="mb-3">
  <div class="container">
    <div class="card-header top-heading-card">
      <h3 class="inside-heading mb-0">All Customers</h3>
    </div>
    <div class="card">
      <div class="card-body pb-0 mt-4">
        <!-- section -->
        <section class="mb-3">
          <div class="container">
            <div class="card">
              <div class="card-body">
                <div class="row">
                  <div class="col-lg-12">
                    <button
                      type="button"
                      class="btn btn-primary color float-right"
                      id="add_customer"
                      placement="top"
                      ngbTooltip="Add Customer"
                      [routerLink]="['/customer/create']"
                    >
                      <i class="fas fa-user-plus mr-2"></i>Add Customer
                    </button>
                  </div>
                </div>
                <form #customerForm="ngForm">
                  <div class="row">
                    <div class="col-sm-12 col-md-6 col-lg-4">
                      <mat-form-field>
                        <input
                          type="text"
                          maxlength="150"
                          matInput
                          placeholder="Company"
                          name="company"
                          [(ngModel)]="searchCustomerObj.company"
                        />
                      </mat-form-field>
                    </div>
                    <div class="col-sm-12 col-md-6 col-lg-4">
                      <mat-form-field>
                        <input
                          type="text"
                          maxlength="150"
                          matInput
                          placeholder="First Name"
                          name="first_name"
                          [(ngModel)]="searchCustomerObj.first_name"
                        />
                      </mat-form-field>
                    </div>
                    <div class="col-sm-12 col-md-6 col-lg-4">
                      <mat-form-field>
                        <input
                          type="text"
                          maxlength="150"
                          matInput
                          placeholder="Last Name"
                          name="last_name"
                          [(ngModel)]="searchCustomerObj.last_name"
                        />
                      </mat-form-field>
                    </div>
                  </div>
                  <div id="collapseCustomer" class="collapse">
                    <div class="row">
                      <div class="col-sm-12 col-md-6 col-lg-4">
                        <mat-form-field>
                          <input
                            type="text"
                            maxlength="150"
                            matInput
                            placeholder="Address Line 1"
                            name="address_no_1"
                            [(ngModel)]="searchCustomerObj.address_1"
                          />
                        </mat-form-field>
                      </div>
                      <div class="col-sm-12 col-md-6 col-lg-4">
                        <mat-form-field>
                          <input
                            type="text"
                            maxlength="150"
                            matInput
                            placeholder="Address Line 2"
                            name="address_no_2"
                            [(ngModel)]="searchCustomerObj.address_2"
                          />
                        </mat-form-field>
                      </div>
                      <div class="col-sm-12 col-md-6 col-lg-4">
                        <mat-form-field>
                          <mat-select
                            id="cities"
                            name="cities"
                            #city_id="ngModel"
                            placeholder="City"
                            [(ngModel)]="searchCustomerObj.city_id"
                          >
                            <mat-option
                              *ngFor="let city of cities"
                              [value]="city.id"
                              >{{ city.name }}</mat-option
                            >
                          </mat-select>
                        </mat-form-field>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-sm-12 col-md-6 col-lg-4">
                        <mat-form-field>
                          <mat-select
                            id="state_ID"
                            name="state_id"
                            #state_id="ngModel"
                            placeholder="State"
                            [(ngModel)]="searchCustomerObj.state_id"
                          >
                            <mat-option
                              *ngFor="let state of states"
                              [value]="state.id"
                              >{{ state.name }}</mat-option
                            >
                          </mat-select>
                        </mat-form-field>
                      </div>
                      <div class="col-sm-12 col-md-6 col-lg-4">
                        <mat-form-field>
                          <input
                            type="text"
                            maxlength="5"
                            matInput
                            placeholder="Zip Code"
                            name="zipCode"
                            onkeypress="return (event.charCode == 8 || event.charCode == 0) ? null : event.charCode >= 46 && event.charCode != 47 && event.charCode <= 57"
                            [(ngModel)]="searchCustomerObj.zip_code"
                          />
                        </mat-form-field>
                      </div>
                      <div class="col-sm-12 col-md-6 col-lg-4">
                        <mat-form-field>
                          <input
                            type="text"
                            maxlength="150"
                            matInput
                            placeholder="Subdivision Name"
                            name="subdivisionName"
                            [(ngModel)]="searchCustomerObj.sub_division_name"
                          />
                        </mat-form-field>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-sm-12 col-md-6 col-lg-4">
                        <mat-form-field>
                          <input
                            type="text"
                            maxlength="150"
                            matInput
                            placeholder="Major Intersection"
                            name="majorIntersection"
                            [(ngModel)]="searchCustomerObj.major_intersection"
                          />
                        </mat-form-field>
                      </div>
                      <div class="col-sm-12 col-md-6 col-lg-4">
                        <mat-form-field>
                          <input
                            type="text"
                            maxlength="15"
                            matInput
                            placeholder="Mobile Phone"
                            name="phone_no"
                            placeholder="Mobile Phone"
                            onkeypress="return (event.charCode == 8 || event.charCode == 0) ? null : (event.charCode >= 46 && event.charCode != 47 && event.charCode <= 57) || event.charCode == 43"
                            [(ngModel)]="searchCustomerObj.mobile_phone"
                          />
                        </mat-form-field>
                      </div>
                      <div class="col-sm-12 col-md-6 col-lg-4">
                        <mat-form-field>
                          <input
                            type="text"
                            maxlength="150"
                            matInput
                            placeholder="Email"
                            name="email"
                            [(ngModel)]="searchCustomerObj.email"
                          />
                        </mat-form-field>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-sm-12 col-md-6 col-lg-4">
                        <mat-form-field>
                          <input
                            type="text"
                            maxlength="150"
                            matInput
                            placeholder="Fax"
                            name="fax"
                            [(ngModel)]="searchCustomerObj.fax"
                          />
                        </mat-form-field>
                      </div>
                      <div class="col-sm-12 col-md-6 col-lg-4">
                        <mat-form-field>
                          <mat-select
                            id="potentialTypes"
                            name="potentialTypes"
                            #potentialTypes="ngModel"
                            placeholder="Customer Potential"
                            [(ngModel)]="searchCustomerObj.potential_type_id"
                          >
                            <mat-option
                              *ngFor="let potentialtype of potential"
                              [value]="potentialtype.id"
                            >
                              {{ potentialtype.name }}
                            </mat-option>
                          </mat-select>
                        </mat-form-field>
                      </div>
                      <div class="col-sm-12 col-md-6 col-lg-4">
                        <mat-form-field>
                          <input
                            type="date"
                            step="1"
                            matInput
                            name="createdOn"
                            placeholder="Date Created"
                            [(ngModel)]="searchCustomerObj.created_on"
                          />
                        </mat-form-field>
                      </div>
                    </div>
                  </div>
                  <div class="row justify-content-between mt-2">
                    <div class="col-sm-6 col-md-6 float-left">
                      <button
                        type="button"
                        data-toggle="collapse"
                        class="btn btn-primary color"
                        href="#collapseCustomer"
                        aria-expanded="false"
                        aria-controls="collapseCustomer"
                      >
                        &nbsp;
                        <i class="fas mr-2"></i>
                      </button>
                    </div>
                    <div class="col-sm-6 col-md-6 float-right">
                      <button
                        type="button"
                        class="btn btn-primary color float-right ml-3"
                        id="search_button"
                        (click)="
                          CurrentPageNo = 1; onGetCustomerSearchFilterMeta()
                        "
                      >
                        <i class="fas fa-search mr-2"></i>Search
                      </button>
                      <button
                        type="submit"
                        class="btn btn-outline color d-block ml-auto"
                        (click)="onResetResult()"
                      >
                        <i class="fas fa-undo-alt mr-2"></i>Reset
                      </button>
                    </div>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </section>
        <!-- section end -->
        <div class="row justify-content-end pb-3">
          <div class="col-auto float-left pr-0">
            <button
              type="button"
              class="btn btn-primary color float-right"
              (click)="onExportReportsToExcl(false)"
              id="add_project"
              placement="top"
              ngbTooltip="Export Csv"
            >
              <i class="fas fa-file-csv mr-1"></i> Export Csv
            </button>
          </div>
          <div class="col-auto float-left">
            <button
              type="button"
              class="btn btn-primary color"
              id="add_project"
              (click)="onExportReportsToExcl(true)"
              placement="top"
              ngbTooltip="Export Excl"
            >
              <i class="fas fa-file-excel mr-1"></i> Export Excel
            </button>
          </div>
        </div>
        <div class="table-responsive table-striped">
          <table class="table">
            <!-- {{_sharedService.logged_user_roles | json}}
              {{ _sharedService.limit_access_array_1 | json}} -->
            <thead>
              <tr>
                <th scope="col">First Name</th>
                <th scope="col">Last Name</th>
                <th scope="col">Company</th>
                <th scope="col">Create Date</th>
                <th scope="col">Date Modified</th>
                <ng-container
                  *ngIf="
                    _sharedService.role_flags.is_administrator == true ||
                    _sharedService.role_flags.is_coordinator == true
                  "
                >
                  <th scope="col">Actions</th>
                </ng-container>
                <!-- <th scope="col">Export As</th> -->
              </tr>
            </thead>
            <tbody *ngIf="customerDetails?.length > 0">
              <!-- | searchfilter : first_name && last_name || phone_no -->
              <tr
                *ngFor="
                  let customerdetail of customerDetails
                    | paginate
                      : {
                          id: 'server',
                          itemsPerPage: 10,
                          currentPage: CurrentPageNo,
                          totalItems: customer_count
                        }
                "
              >
                <td>{{ customerdetail.first_name }}</td>
                <td>{{ customerdetail.last_name }}</td>
                <td>{{ customerdetail.company }}</td>
                <td>{{ customerdetail.created_at }}</td>
                <td>{{ customerdetail.updated_at }}</td>
                <ng-container
                  *ngIf="
                    _sharedService.role_flags.is_administrator == true ||
                    _sharedService.role_flags.is_coordinator == true
                  "
                >
                  <td>
                    <a
                      [routerLink]="['/customer/view', customerdetail.id]"
                      placement="top"
                      ngbTooltip="View"
                    >
                      <i class="fas fa-eye" style="margin-right: 7px"></i
                    ></a>
                    <a
                      [routerLink]="['/customer/edit', customerdetail.id]"
                      placement="top"
                      ngbTooltip="Edit"
                    >
                      <!-- <i class="ml-3 fas fa-edit"></i> -->
                      <svg
                        aria-hidden="true"
                        style="width: 12px; margin-left: 7px"
                        focusable="false"
                        data-prefix="fas"
                        data-icon="edit"
                        role="img"
                        xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 576 512"
                        class="svg-inline--fa fa-edit fa-w-18 fa-spin fa-lg"
                      >
                        <path
                          fill="currentColor"
                          d="M402.6 83.2l90.2 90.2c3.8 3.8 3.8 10 0 13.8L274.4 405.6l-92.8 10.3c-12.4 1.4-22.9-9.1-21.5-21.5l10.3-92.8L388.8 83.2c3.8-3.8 10-3.8 13.8 0zm162-22.9l-48.8-48.8c-15.2-15.2-39.9-15.2-55.2 0l-35.4 35.4c-3.8 3.8-3.8 10 0 13.8l90.2 90.2c3.8 3.8 10 3.8 13.8 0l35.4-35.4c15.2-15.3 15.2-40 0-55.2zM384 346.2V448H64V128h229.8c3.2 0 6.2-1.3 8.5-3.5l40-40c7.6-7.6 2.2-20.5-8.5-20.5H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V306.2c0-10.7-12.9-16-20.5-8.5l-40 40c-2.2 2.3-3.5 5.3-3.5 8.5z"
                          class=""
                        ></path>
                      </svg>
                    </a>
                    <ng-container
                      *ngIf="_sharedService.role_flags.is_administrator == true"
                    >
                      <a
                        (click)="
                          openDeleteCustomerModal(
                            deleteCustomerModal,
                            customerdetail.id
                          )
                        "
                        ><i
                          style="cursor: pointer"
                          placement="top"
                          ngbTooltip="Delete"
                          class="ml-3 fas fa-trash"
                        >
                        </i>
                      </a>
                    </ng-container>
                  </td>
                </ng-container>
                <!-- <td>
                  <i class="fas fa-download" style="cursor: pointer" ngbTooltip="Download CSV File" placement="top"></i>
                  <i class="fas ml-3 fa-file-excel" style="cursor: pointer" ngbTooltip="Download Excel File"
                    placement="top"></i>
                </td> -->
              </tr>
            </tbody>
            <tr *ngIf="customerDetails.length == 0">
              <td colspan="6">
                <p class="text-center">No customer found</p>
              </td>
            </tr>
          </table>
        </div>
        <div class="row justify-content-end">
          <div *ngIf="customer_count > 10" class="col">
            <pagination-controls
              (pageChange)="
                CurrentPageNo = $event; onGetCustomerSearchFilterMeta()
              "
              directionLinks="true"
              responsive="true"
              id="server"
              class="text-right"
            ></pagination-controls>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<ng-template #deleteCustomerModal let-c="close" let-d="dismiss">
  <div class="modal-header">
    <h6 class="modal-title">Delete Customer</h6>
    <button type="button" class="close" (click)="c('Close click')">
      &times;
    </button>
  </div>
  <div class="modal-body">
    <h6 style="color: red">Are you sure to delete this customer?</h6>
    <div class="modal-footer">
      <button
        type="button"
        class="btn btn-primary-outline color"
        (click)="c('Close click')"
      >
        Close
      </button>
      <button
        type="submit"
        class="btn btn-primary color"
        (click)="ondeleteCustomers(customerId)"
      >
        Delete
      </button>
    </div>
  </div>
</ng-template>
